---
layout: layouts/base.njk
title: jisk
---

{% block content %}
<section class="intro">
  <p>
    This is a web tool that helps you jump from a specific web
    service to an alternative front end, such as Redlib, Invidious, and others. The tool automatically selects one
    of the available instances for the service youâ€™re redirecting to, which is particularly useful when combined
    with browser extensions for automatic redirects.
  </p>
</section>

<section class="info">
  <h3>Redirection URL Builder</h3>
  <p>The redirection URL is generated based on the following parameters at the bottom:</p>
  <div class="form-group">
    <label for="service">Alternative front end</label>
    <select id="service" name="service">
      {% for service in services.services %}
        <option value="{{ service.id }}">{{ service.name }}</option>
      {% endfor %}
    </select>
    <small>The alternative service you want to redirect to.</small>
  </div>

  <div class="form-group">
    <label for="url">Source URL</label>
    <input type="text" id="url" name="url" required>
    <div class="form-check">
      <input type="checkbox" id="encodesUrl" name="encodesUrl" checked>
      <label for="encodesUrl">Apply URL encoding</label>
    </div>
    <small>The original URL you want to redirect from. You may use "$0" without URL encoding for automatic redirection through your browser extension.</small>
  </div>

  <div class="form-group">
    <label for="countries">Country codes (optional):</label>
    <input type="text" id="countries" name="countries" placeholder="JP, TW, CN">
    <small>Country codes for the locations of the instances (e.g., JP for Japan, TW for Taiwan), listed in a comma-separated, case-insensitive format.</small>
  </div>

  <div class="form-group">
    <label for="cache-expiry">Cache expiry (seconds, optional):</label>
    <input type="number" id="cache-expiry" name="cache-expiry" placeholder="86400">
    <small>The cache expiry time in seconds (e.g., 86400 for 24 hours). If you set 0, jisk doesn't remember the instance selected last time.</small>
  </div>

  <div id="result" class="example"></div>
</section>

<section class="info example">
  <h3>Examples</h3>
  <ul>
    <li><a class="video-link" href="invidious?url=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DykG90lE2fGA"></a></li>
    <li><a class="video-link" href="redlib?url=https%3A%2F%2Fnew.reddit.com%2Fr%2Fjavascript%2Fcomments%2Fo4tjz6"></a></li>
    <li><a class="video-link" href="rimgo?url=https%3A%2F%2Fimgur.com%2Fgallery%2Fdaily-snick-pic-43-ZKmPPvy%23%2Ft%2Faww"></a></li>
  </ul>
</section>

<script type="module">
  import { makeRedirectionUrl } from './assets/js/redirectionUrlBuilder.js';

  const services = {{ services.services | dump | safe }}

  let baseUrl = "{{ baseUrl }}";
  if (baseUrl === '') {
    baseUrl = window.location.origin;
  }

  document.querySelectorAll('.video-link').forEach(link => {
    link.textContent = link.href;
  });

  function updateUI() {
    const serviceName = document.getElementById('service').value;
    const urlEl = document.getElementById('url')
    const sourceUrl = urlEl.value;
    const encodesSourceUrl = document.getElementById('encodesUrl').checked;
    const countries = document.getElementById('countries').value
      .split(',')
      .map(country => country.trim())
      .filter(country => country.length > 0);
    const cacheExpiry = document.getElementById('cache-expiry').value;

    urlEl.placeholder = services.find(service => service.id === serviceName).urlPlaceholder;
    {# TODO: Remove this when this issue is completed: https://codeberg.org/Codeberg/pages-server/issues/298 #}
    const hasHtmlExtension = new URL(baseUrl).hostname.endsWith('.codeberg.page')

    const redirectUrl = makeRedirectionUrl({
      baseUrl,
      serviceName,
      sourceUrl,
      encodesSourceUrl,
      countries,
      hasHtmlExtension,
      cacheExpiry,
    });
    const resultDiv = document.getElementById('result');
    resultDiv.innerHTML = `<p>Generated Redirect URL:</p><a href="${redirectUrl}" target="_blank">${redirectUrl}</a>`;
  }

  document.getElementById('service').addEventListener('change', updateUI);
  document.getElementById('url').addEventListener('input', updateUI);
  document.getElementById('encodesUrl').addEventListener('change', updateUI);
  document.getElementById('countries').addEventListener('input', updateUI);
  document.getElementById('cache-expiry').addEventListener('input', updateUI);

  updateUI();
</script>
{% endblock %}
